%--------------------------------------------
% $Header: /cvsroot/pgfplots/pgfplots/generic/pgfplots/libs/pgflibrarysurfshading.code.tex,v 1.2 2009/02/26 13:25:20 ludewich Exp $
%
% Package pgfplots
%
% Provides a user-friendly interface to create function plots (normal
% plots, semi-logplots and double-logplots).
% 
% It is based on Till Tantau's PGF package.
%
% Copyright 2007/2008 by Christian Feuers√§nger.
%
% This program is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
% 
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
% 
% You should have received a copy of the GNU General Public License
% along with this program.  If not, see <http://www.gnu.org/licenses/>.
%
%--------------------------------------------

\def\pgfplotslibrarysurf@width{5cm}%
\def\pgfplotslibrarysurf@height{5cm}%
\def\pgfplotslibrarysurf@cols{4}%
\def\pgfplotslibrarysurf@binarystream{1234}%
\def\pgfplotslibrarysurf@binarystreamlength{4}%
\def\pgfplotslibrarysurf@decode{xmin xmax ymin ymax c1min c1max c2min c2max c3min c3max}%

\def\pgfplotssys@do@surfshading{%
	{%
\iffalse
		\pdfobj stream attr {%
			/Length \pgfplotslibrarysurf@binarystreamlength
			%/Shading 
			<< 
				/Sh << 
					/ShadingType 5
					/BitsPerCoordinate 32
					/BitsPerComponent 16
					/VerticesPerRow \pgfplotslibrarysurf@cols
					/ColorSpace /DeviceRGB
					/Decode [\pgfplotslibrarysurf@decode]
				>> 
			>>%
		} {%
			\pgfplotslibrarysurf@binarystream
		}%
\else
		% A working temporary:
		\pdfobj {
			<< /Sh 
				<<
					/ShadingType 2 
					/ColorSpace /DeviceRGB
					/Domain [0.0 226.76788] 
					/Coords [0.0 0 226.76788 0] 
					/Function 
					<< 
						/FunctionType 3 
						/Domain [0.0 226.76788] 
						/Functions [ 
							<< 
								/FunctionType 2 
								/Domain [0.0 226.76788] 
								/C0 [0 0 1] /C1 [1 1 0] /N 1 
							>>  
							<< 
								/FunctionType 2 
								/Domain [0.0 226.76788] 
								/C0 [1 1 0] /C1 [1 0.5 0] /N 1 
							>>  
							<< 
								/FunctionType 2 
								/Domain [0.0 226.76788] 
								/C0 [1 0.5 0] /C1 [1 0 0] /N 1 
							>>
						]
						/Bounds [ 75.5893 151.17859] 
						/Encode [0 1  0 1 0 1] 
					>> 
					/Extend [false false] 
				>> 
			>>
		}%
\fi
		% I don't know how to insert the shading into a properly sized PDF entity - this here appears to work.
		\setbox\pgfutil@tempboxa=\hbox to\pgfplotslibrarysurf@width{%
			\vbox to\pgfplotslibrarysurf@height{%
				\vfil
				\pgfsys@invoke{/Sh sh}%
			}%
			\hfil}%
		\pdfxform resources {%
			/Shading \the\pdflastobj\space 0 R
		}\pgfutil@tempboxa
		%--------------------------------------------------
		% \pgf@process{\pgfpoint{\pgf@max}{#2}}%
		% \pdfxform resources {%
		% 	/Shading << 
		% 		/Sh << 
		% /Length <BYTES>
		% 			/ShadingType 5
		% 			/BitsPerCoordinate 32
		% 			/BitsPerComponent 16
		% 			/VerticesPerRow \pgfplotslibrarysurf@cols
		% 			/ColorSpace /DeviceRGB
		% 			/Decode [xmin xmax ymin ymax c1min c1max c2min c2max c3min c3max ]
		% 		>> 
		% 	>>}\pgfutil@tempboxa% <<
		%-------------------------------------------------- 
		\xdef\pgfplots@glob@TMPa{
			\leavevmode
			\noexpand\pdfrefobj\the\pdflastobj
			\noexpand\pdfrefxform\the\pdflastxform}% 
	}%
	\pgfplots@glob@TMPa
}
