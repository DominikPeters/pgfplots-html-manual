\documentclass[a4paper]{article}

\usepackage[intlimits]{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{ifpdf}
\usepackage{listings}
\usepackage{rotating}

\usepackage{array}
\usepackage{booktabs}
\usepackage{colortbl}

\lstset{basicstyle=\ttfamily\footnotesize,tabsize=16}

\ifpdf
\else
\def\pgfsysdriver{pgfsys-dvipdfm.def}
\fi
\usepackage{pgfplots}

\parindent=0pt

\def\testsection#1{\message{STARTING TEST SECTION '#1'}\section{#1}}
\def\testsubsection#1{\message{STARTING TEST SUBSECTION '#1'}\subsection{#1}}
\def\testsubsubsection#1{\message{STARTING TEST SUBSUBSECTION '#1'}\subsubsection{#1}}

\author{Christian Feuers\"anger}
\title{Test cases for pgfplotstable}

\begin{document}
\maketitle

\testsection{Reading a tab-separated table with many entries}
\begin{sidewaystable}
	\lstinputlisting{numtabletestdata}
\end{sidewaystable}
\testsubsection{Reading it...}
\tracingmacros=2\tracingcommands=2
\pgfplotstableread{numtabletestdata} to \table
\tracingmacros=0\tracingcommands=0

\testsubsection{Quering colnames...}
\tracingmacros=2\tracingcommands=2
\pgfplotstablegetcolumnlist\table\to\cols
\pgfplotslistforeach\cols\as\col{Column ``\col''\par}%
\tracingmacros=0\tracingcommands=0

\testsubsection{Quering column content by column name}
\tracingmacros=2\tracingcommands=2
\pgfplotstablegetcolumnbyname L2\of\table\to\colcontent
\pgfplotslistforeach\colcontent\as\colc{Row data: ``\colc''\par}%
\tracingmacros=0\tracingcommands=0

\testsubsection{Quering column content by column name for all cols}
\pgfplotstablegetcolumnlist\table\to\cols
\pgfplotslistforeach\cols\as\col{\textbf{Column ``\col''}\par
	\pgfplotstablegetcolumnbyname\col\of\table\to\colcontent
	\pgfplotslistforeach\colcontent\as\colc{Row data: ``\colc''\par}%
}%

\testsection{Reading gnuplot output for use in 'plot file'}
\lstinputlisting{numtabletestdata2.gnuplot}
\tracingmacros=2\tracingcommands=2
\pgfplotstableread{numtabletestdata2.gnuplot} to \table
\tracingmacros=0\tracingcommands=0

\testsubsection{Quering column content by column name for all cols}
\pgfplotstablegetcolumnlist\table\to\cols
\pgfplotslistforeach\cols\as\col{\textbf{Column ``\col''}\par
	\pgfplotstablegetcolumnbyname\col\of\table\to\colcontent
	\pgfplotslistforeach\colcontent\as\colc{Row data: ``\colc''\par}%
}%

\testsection{Table typesetting}
\pgfplotstableread{numtabletestdata}\table

\testsubsection{no options at all}
\pgfplotstabletypeset\table

\testsubsection{Basis, L2, no options}
\tracingmacros=2\tracingcommands=2
\pgfplotstabletypeset[columns={Basis,L2}]\table
\tracingmacros=0\tracingcommands=0

\testsubsection{some column adjustments}
\pgfplotstabletypeset[
	columns={maxlevel,Basis,L2,cgiter},
	columns/maxlevel/.style={column name=$l_\infty$,column type=r},
	columns/cgiter/.style={column name={CG}},
	columns/L2/.style={column name={$L_2$},/pgf/number format/sci subscript,/pgf/number format/sci zerofill}]
	\table

\testsubsection{some row adjustments}
\pgfplotstabletypeset[
	/pgf/number format/sci subscript,/pgf/number format/sci zerofill,
	every head row/.style={before row=\toprule,after row=\midrule},
	every last row/.style={after row=\bottomrule},
	]
	\table


\testsubsection{coloring rows}

\pgfplotstabletypeset[
	every even row/.style={before row={\rowcolor[gray]{0.9}}},
	every head row/.style={before row=\toprule,after row=\midrule},
	every last row/.style={after row=\bottomrule},
	]
	\table

\testsubsubsection{writing to numtabletest.generated1.tex}%
\pgfplotstabletypeset[
	outfile=numtabletest.generated1.tex,
	every even row/.style={before row={\rowcolor[gray]{0.9}}},
	every head row/.style={before row=\toprule,after row=\midrule},
	every last row/.style={after row=\bottomrule},
	]
	\table

\testsubsubsection{loading numtabletest.generated1.tex}
\input{numtabletest.generated1.tex}

\testsubsection{Choosing columns by index}
\tracingmacros=2\tracingcommands=2
\pgfplotstabletypeset[
	columns={[index]5,dof,[index]0}
	]
	\table
\tracingmacros=0\tracingcommands=0

\testsubsection{column styles}
\pgfplotstabletypeset[
	every even column/.style={column type={>{\columncolor[gray]{.8}[\tabcolsep]}l}},
	]
	\table

\begingroup
\testsubsection{column styles + string type}
\pgfplotstableread{numtabletestdata2}\table
\tracingmacros=2\tracingcommands=2
\pgfplotstabletypeset[
	every first column/.style={string type,column type={@{}r|},column name=},
	every head row/.style={after row=\hline},
	every even column/.style={column type={>{\columncolor[gray]{.8}[\tabcolsep]}l}},
	]
	\table
\endgroup

\end{document}
